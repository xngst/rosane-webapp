{% extends "base.html" %}
{% block title %}P√ÅLY√ÅZATOK{% endblock %}
{% block content %}

<link href="https://unpkg.com/gridjs/dist/theme/mermaid.min.css" rel="stylesheet"/>

<div class="container">
  <h1 class="title" id="highlight">P√ÅLY√ÅZATOK</h1>
  <div class="box">
  <div id="cards" class="is-hidden"></div>
  <div id="table"></div>
</div>
</div>


<script src="https://unpkg.com/gridjs/dist/gridjs.umd.js"></script>
<script>
const entries = [
  {% for entry in entries %}
    {
      id: "{{ entry.id }}",
      title: "{{ entry.title|escape }}",
      category: "{{ entry.category|escape }}",
      city: "{{ entry.city|escape }}",
      applicant: "{{ entry.applicant_name|escape }}",
      like_count: "{{ entry.like_count }}"
    }{{ "," if not loop.last }}
  {% endfor %}
];

// Render as cards on mobile
if (window.innerWidth < 768) {
  document.getElementById('table').style.display = 'none';
  document.getElementById('cards').classList.remove('is-hidden');

  const container = document.getElementById('cards');
  entries.forEach(entry => {
    const card = document.createElement('div');
    card.className = 'card mb-4';
    card.innerHTML = `
      <div class="card-content">
        <p class="title is-5">${entry.title}</p>
        <p><strong>Kateg√≥ria:</strong> ${entry.category}</p>
        <p><strong>V√°ros:</strong> ${entry.city}</p>
        <p><strong>P√°ly√°z√≥:</strong> ${entry.applicant}</p>
        <p><strong>Kedvel√©sek:</strong> ${entry.like_count}</p>
        <form method="POST" action="/like/${entry.id}" class="mt-2">
          <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
          <button type="submit" class="button is-primary is-small">üëç Ez tetszik!</button>
        </form>
        <a href="/adatlap/${entry.id}" class="button is-link is-light is-small mt-2">R√©szletek</a>
      </div>
    `;
    container.appendChild(card);
  });
} else {
  // Render Grid.js for larger screens
  new gridjs.Grid({
    columns: [
      { id: 'id', name: 'ID', hidden: true },
      { id: 'title', name: 'Elnevez√©s' },
      { id: 'category', name: 'Kateg√≥ria' },
      { id: 'city', name: 'V√°ros' },
      { id: 'applicant', name: 'P√°ly√°z√≥' },
      { id: 'like_count', name: 'Kedvel√©sek' },
      {
        name: 'Szavaz√°s',
        formatter: (cell, row) => {
          return gridjs.html(`
            <form method="POST" action="/like/${row.cells[0].data}">
              <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
              <button type="submit" class="button is-primary is-small">üëç Ez tetszik!</button>
            </form>
          `);
        }
      },
      {
        name: 'Adatlap',
        formatter: (cell, row) => {
          return gridjs.html(`
            <a href="/adatlap/${row.cells[0].data}" class='has-text-link'>R√©szletek</a>
          `);
        }
      }
    ],
    data: entries.map(e => [
      e.id, e.title, e.category, e.city, e.applicant, e.like_count
    ]),
    search: true,
    sort: true,
    resizable: true,
    pagination: {
      enabled: true,
      summary: true
    },
    language: {
      'search': { 'placeholder': 'Keres√©s...' },
      'pagination': {
        'previous': 'El≈ëz≈ë',
        'next': 'K√∂vetkez≈ë',
        'showing': 'Megjelen√≠tve',
        'results': () => 'tal√°lat'
      },
      'loading': 'Bet√∂lt√©s...',
      'noRecordsFound': 'Nincs tal√°lat',
      'error': 'Hiba t√∂rt√©nt az adatok bet√∂lt√©sekor'
    }
  }).render(document.getElementById('table'));
}
</script>

{% endblock %}

